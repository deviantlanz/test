--<< SETTINGS >>
local GUI_WIDTH = 180
local GUI_HEIGHT = 80
local HITBOX_SIZE = 4

--<< CREATE GUI >>
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.ResetOnSpawn = false

-- Hide/Show Button
local ToggleButton = Instance.new("TextButton", ScreenGui)
ToggleButton.Size = UDim2.new(0, 70, 0, 25)
ToggleButton.Position = UDim2.new(1, -80, 0, 10)
ToggleButton.BackgroundColor3 = Color3.fromRGB(40,40,40)
ToggleButton.TextColor3 = Color3.fromRGB(255,255,255)
ToggleButton.Text = "Hide"

-- Main Frame
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, GUI_WIDTH, 0, GUI_HEIGHT)
MainFrame.Position = UDim2.new(1, -GUI_WIDTH - 20, 0, 50)
MainFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
MainFrame.Active = true
MainFrame.Draggable = true
Instance.new("UICorner", MainFrame)

local List = Instance.new("UIListLayout", MainFrame)
List.Padding = UDim.new(0,4)

local function newButton(text)
	local b = Instance.new("TextButton", MainFrame)
	b.Size = UDim2.new(1, -10, 0, 22)
	b.BackgroundColor3 = Color3.fromRGB(50,50,50)
	b.TextColor3 = Color3.fromRGB(255,255,255)
	b.Text = text
	Instance.new("UICorner", b)
	return b
end

-- Buttons (size buttons removed)
local HitboxButton = newButton("Hitbox: OFF")
local ChestESPButton = newButton("Chest ESP: OFF")
local TeleportButton = newButton("Teleport Chest")

-- Vars
local hitboxOn = false
local espOn = false

local espFolder = Instance.new("Folder", ScreenGui)
espFolder.Name = "ChestESPs"

------------------------------------------------------
-- HITBOX SYSTEM (HEAD ONLY)
------------------------------------------------------
local function applyHitboxToModel(model)
	if not hitboxOn then return end
	if model.Parent ~= game.Workspace.Entity then return end

	local head = model:FindFirstChild("Head")
	if not head then return end

	head.Size = Vector3.new(HITBOX_SIZE, HITBOX_SIZE, HITBOX_SIZE)
	head.CanCollide = false
	head.Transparency = 0.5
	head.Color = Color3.fromRGB(255,0,0)
end

local function removeHitboxFromModel(model)
	local head = model:FindFirstChild("Head")
	if not head then return end
	head.Size = Vector3.new(2,1,1)
	head.Transparency = 1
end

local function applyHitbox()
	for _, mob in ipairs(game.Workspace.Entity:GetChildren()) do
		if mob:IsA("Model") then
			if hitboxOn then applyHitboxToModel(mob)
			else removeHitboxFromModel(mob) end
		end
	end
end

-- Auto apply to new mobs
game.Workspace.Entity.ChildAdded:Connect(function(child)
	task.wait(0.1)
	if child:IsA("Model") then
		applyHitboxToModel(child)
	end
end)

------------------------------------------------------
-- CHEST ESP (outline only)
------------------------------------------------------
local function makeOutline(part)
	local hl = Instance.new("Highlight", espFolder)
	hl.Adornee = part
	hl.FillTransparency = 1
	hl.OutlineColor = Color3.fromRGB(255,255,0)
	return hl
end

local function isChest(model)
	return model.Name:lower():find("chest")
end

local function addChestESP(model)
	for _, obj in ipairs(model:GetDescendants()) do
		if obj:IsA("BasePart") then
			makeOutline(obj)
		end
	end
end

local function refreshChestESP()
	espFolder:ClearAllChildren()

	if not espOn then return end

	for _, v in ipairs(game.Workspace:GetDescendants()) do
		if isChest(v) and v:IsA("Model") then
			addChestESP(v)
		end
	end
end

-- Auto ESP for new chests
game.Workspace.DescendantAdded:Connect(function(v)
	if espOn and v:IsA("Model") and isChest(v) then
		task.wait(0.2)
		addChestESP(v)
	end
end)

------------------------------------------------------
-- BUTTON EVENTS
------------------------------------------------------
HitboxButton.MouseButton1Click:Connect(function()
	hitboxOn = not hitboxOn
	HitboxButton.Text = "Hitbox: " .. (hitboxOn and "ON" or "OFF")
	applyHitbox()
end)

ChestESPButton.MouseButton1Click:Connect(function()
	espOn = not espOn
	ChestESPButton.Text = "Chest ESP: " .. (espOn and "ON" or "OFF")
	refreshChestESP()
end)

TeleportButton.MouseButton1Click:Connect(function()
	local plr = game.Players.LocalPlayer
	local hrp = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	local nearest, dist = nil, math.huge
	for _, v in ipairs(game.Workspace:GetDescendants()) do
		if isChest(v) and v:IsA("Model") then
			local part = v:FindFirstChildWhichIsA("BasePart")
			if part then
				local d = (hrp.Position - part.Position).Magnitude
				if d < dist then
					dist = d
					nearest = part
				end
			end
		end
	end

	if nearest then
		hrp.CFrame = nearest.CFrame + Vector3.new(0, 3, 0)
	end
end)

ToggleButton.MouseButton1Click:Connect(function()
	MainFrame.Visible = not MainFrame.Visible
	ToggleButton.Text = MainFrame.Visible and "Hide" or "Show"
end)
